<?php    namespace Wptt;    \CModule::IncludeModule('iblock');    \CModule::IncludeModule('highloadblock');    class Counter {        /**         * Получает ID инфоблока         * @param $type         * @param $code         *         * @return false|mixed         */        static public function getIblockID ($type, $code) {            $result = false;            $res = \CIBlock::GetList(                Array(),                Array(                    'TYPE'=> $type,                    'SITE_ID'=>SITE_ID,                    'ACTIVE'=>'Y',                    "CNT_ACTIVE"=>"Y",                    "CODE"=> $code                ), true            );            while($ar_res = $res->Fetch())            {                $result = $ar_res['ID'];            }            return $result;        }        /**         * Получает колличество элементов инфоблока         * @param $type         * @param $code         * @param array $filter         *         * @return int         */        static public function getCount($type, $code, $filter = []){            $result = 0;            if ($iblockId = self::getIblockID($type, $code)) {                $arSelect = Array("ID", "IBLOCK_ID", "NAME", "DATE_ACTIVE_FROM","PROPERTY_*");                $arFilter = Array("IBLOCK_ID"=> $iblockId, "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y");                if (!empty($filter)) {                    $arFilter = array_merge($arFilter, $filter);                }                $res = \CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);                while($ob = $res->GetNextElement()){                    $result++;                }            }            return $result;        }        static public function getCountForDirection($idDirection, $type = 'catalog', $codePrograms = 'programs') {            $result['PROGRAMS'] = 0;            $result['PROFESSIONS'] = 0;            if ($iblockId = self::getIblockID($type, $codePrograms)) {                $arSelect = Array("ID", "IBLOCK_ID", "NAME", "DATE_ACTIVE_FROM","PROPERTY_*");                $arFilter = Array("IBLOCK_ID"=> $iblockId, "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y", 'PROPERTY_DIRECTION' => $idDirection);                $res = \CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);                while($ob = $res->GetNextElement()){                    $arFields = $ob->GetFields();                    $result['PROGRAMS']++;                    $programs[$arFields['ID']] = $arFields['ID'];                }                if (!empty($programs)) {                    $iblockId = self::getIblockID($type, 'professions');                    $arSelect = Array("ID", "IBLOCK_ID", "NAME", "DATE_ACTIVE_FROM","PROPERTY_*");                    $arFilter = Array("IBLOCK_ID"=> $iblockId, "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y", 'PROPERTY_STUDYING_PROGRAMS' => $programs);                    $res = \CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);                    while($ob = $res->GetNextElement()){                        $result['PROFESSIONS']++;                    }                }                if (!empty($programs)) {                    $iblockId = self::getIblockID($type, 'professions');                    $arSelect = Array("ID", "IBLOCK_ID", "NAME", "DATE_ACTIVE_FROM","PROPERTY_*");                    $arFilter = Array("IBLOCK_ID"=> $iblockId, "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y", 'PROPERTY_STUDYING_PROGRAMS' => $programs);                    $res = \CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);                    while($ob = $res->GetNextElement()){                        $arFields = $ob->GetFields();                        $professions[$arFields['ID']] = $arFields['NAME'];                    }                }                $iblockId = self::getIblockID($type, 'professions');                $arSelect = Array("ID", "IBLOCK_ID", "NAME", "DATE_ACTIVE_FROM","PROPERTY_*");                $arFilter = Array("IBLOCK_ID"=> $iblockId, "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y", 'PROPERTY_DIRECTION' => $idDirection);                $res = \CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);                while($ob = $res->GetNextElement()){                    $arFields = $ob->GetFields();                    $professions[$arFields['ID']] = $arFields['NAME'];                }                if (!empty($professions)) {                    foreach ($professions as $profession) {                        $result['PROFESSIONS']++;                    }                }            }            return $result;        }        static public function getCountForProffesion($idPrograms, $idDirection = [], $type = 'catalog', $codePrograms = 'programs') {            $result['PROGRAMS'] = [];            $result['SCHOOLS'] = 0;            if ($iblockId = self::getIblockID($type, $codePrograms)) {                $arSelect = Array("ID", "IBLOCK_ID", "NAME", "DATE_ACTIVE_FROM","PROPERTY_*");                $arFilter = Array("IBLOCK_ID"=> $iblockId, "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y", 'ID' => $idPrograms);                $res = \CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);                while($ob = $res->GetNextElement()){                    $arFileds = $ob->GetFields();                    $arProp = $ob->GetProperties();                    $result['ARR_PROGRAMS'][$arFileds['ID']] = $arFileds['ID'];                    $schools[$arProp['SCHOOL']['VALUE']] = $arProp['SCHOOL']['VALUE'];                }                if (!empty($idDirection)) {                    $arSelect = Array("ID", "IBLOCK_ID", "NAME", "DATE_ACTIVE_FROM","PROPERTY_*");                    $arFilter = Array("IBLOCK_ID"=> $iblockId, "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y", 'PROPERTY_DIRECTION' => $idDirection);                    $res = \CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);                    while($ob = $res->GetNextElement()){                        $arFileds = $ob->GetFields();                        $arProp = $ob->GetProperties();                        $result['ARR_PROGRAMS'][$arFileds['ID']] = $arFileds['ID'];                        $schools[$arProp['SCHOOL']['VALUE']] = $arProp['SCHOOL']['VALUE'];                    }                }                if (!empty($schools)) {                    $iblockId = self::getIblockID($type, 'schools');                    $arSelect = Array("ID", "IBLOCK_ID", "NAME", "DATE_ACTIVE_FROM","PROPERTY_*");                    $arFilter = Array("IBLOCK_ID"=> $iblockId, "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y", 'ID' => $schools);                    $res = \CIBlockElement::GetList(Array(), $arFilter, false, false, $arSelect);                    while($ob = $res->GetNextElement()){                        $result['SCHOOLS']++;                    }                }            }            $result['PROGRAMS'] = count($result['ARR_PROGRAMS']);            return $result;        }    }